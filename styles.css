/* Smooth scroll + active nav */
const links = document.querySelectorAll('.nav-link');
links.forEach(a=>{
  a.addEventListener('click', e=>{
    // allow normal hash navigation; smooth it
    const id = a.getAttribute('href');
    if(id.startsWith('#')){
      e.preventDefault();
      document.querySelector(id).scrollIntoView({behavior:'smooth', block:'start'});
    }
  });
});

function setActive(el){
  links.forEach(l=>l.classList.remove('is-active'));
  el.classList.add('is-active');
}

/* observe sections for active state */
const sections = [...document.querySelectorAll('section[id]')];
const io = new IntersectionObserver((entries)=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){
      const id = '#'+entry.target.id;
      const link = [...links].find(l=>l.getAttribute('href')===id);
      if(link) setActive(link);
    }
  })
},{rootMargin:'-48% 0px -48% 0px', threshold:0});

sections.forEach(s=>io.observe(s));

/* Carousel */
document.querySelectorAll('.carousel').forEach(car=>{
  const imgs = [...car.querySelectorAll('.car-img')];
  let i = 0;
  const show = (idx)=>{
    imgs.forEach((im,k)=>im.classList.toggle('active',k===idx));
  };
  show(i);
  car.querySelector('.next').addEventListener('click', ()=>{ i=(i+1)%imgs.length; show(i); });
  car.querySelector('.prev').addEventListener('click', ()=>{ i=(i-1+imgs.length)%imgs.length; show(i); });
});

/* Progress rings */
document.querySelectorAll('.ring').forEach(r=>{
  const v = +r.dataset.val || 0;
  r.style.setProperty('--val', v);
});

/* Contact: call reveal then dial */
const callBtn = document.getElementById('callBtn');
if(callBtn){
  let revealed = false;
  callBtn.addEventListener('click', ()=>{
    if(!revealed){
      callBtn.textContent = 'Call (+91 70874 33166)';
      revealed = true;
    }else{
      location.href = 'tel:+917087433166';
    }
  });
}
